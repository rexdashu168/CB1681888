<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexå¤§å” AIæ™ºèƒ½å¯è½‰å‚µçŸ¥è­˜åº« v3.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        /* çµ±ä¸€æœå°‹æ¡† */
        .unified-search {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .search-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 18px 25px;
            border: 3px solid #3498db;
            border-radius: 15px;
            font-size: 18px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
        }

        .search-button {
            padding: 18px 40px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);
        }

        .search-tips {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tip-tag {
            background: #ecf0f1;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tip-tag:hover {
            background: #3498db;
            color: white;
        }

        /* çµæœå€åŸŸ */
        .results-container {
            display: none;
        }

        .results-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-color: #2980b9;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* æ–‡ç« å¡ç‰‡ */
        .article-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .article-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .article-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .article-summary {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .article-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tag {
            background: #ecf0f1;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #7f8c8d;
        }

        .read-more {
            display: inline-block;
            padding: 10px 25px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .read-more:hover {
            transform: translateX(5px);
        }

        /* CBè³‡æ–™å¡ç‰‡ */
        .cb-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .cb-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .cb-name {
            font-size: 1.6em;
            color: #2c3e50;
            font-weight: 700;
        }

        .cb-code {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
        }

        .cb-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .cb-info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .cb-info-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .cb-info-value {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 700;
        }

        .cb-purpose {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .cb-purpose-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .cb-purpose-text {
            color: #555;
            line-height: 1.6;
        }

        .no-result {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .no-result-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* çµ±è¨ˆè³‡æ–™ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .stat-title {
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            color: #3498db;
            font-weight: 700;
            margin: 15px 0;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .stat-bar {
            background: #ecf0f1;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            transition: width 0.5s;
        }

        .stat-list {
            list-style: none;
        }

        .stat-list-item {
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-list-item:last-child {
            border-bottom: none;
        }

        /* çŸ¥è­˜äº®é» */
        .insight-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-left: 5px solid #3498db;
        }

        .insight-card.warning {
            border-left-color: #e74c3c;
            background: linear-gradient(to right, #fff5f5, white);
        }

        .insight-card.tip {
            border-left-color: #f39c12;
            background: linear-gradient(to right, #fffbf5, white);
        }

        .insight-card.success {
            border-left-color: #27ae60;
            background: linear-gradient(to right, #f5fff5, white);
        }

        .insight-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .insight-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .insight-content {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .insight-source {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 10px;
        }

        .insight-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .insight-keyword {
            background: #ecf0f1;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“ Rexå¤§å” AIæ™ºèƒ½å¯è½‰å‚µçŸ¥è­˜åº«</h1>
            <p class="subtitle">çµ±ä¸€æœå°‹ç³»çµ± Â· 60ç¯‡æ·±åº¦æ–‡ç«  Â· 2,232ç­†CBå®Œæ•´è³‡æ–™</p>
        </div>

        <!-- çµ±ä¸€æœå°‹å€ -->
        <div class="unified-search">
            <h2 class="search-title">ğŸ” æ™ºèƒ½æœå°‹</h2>
            <div class="search-box">
                <input type="text" 
                       class="search-input" 
                       id="searchInput"
                       placeholder="è¼¸å…¥é—œéµå­—ã€CBä»£è™Ÿã€è‚¡ç¥¨ä»£è™Ÿ... (ä¾‹å¦‚ï¼šç«¶æ‹ã€13164ã€1316ã€å°æ³¥)">
                <button class="search-button" onclick="unifiedSearch()">æœå°‹</button>
            </div>
            <div class="search-tips">
                <span class="tip-tag" onclick="quickSearch('ç«¶æ‹')">ğŸ’¡ ç«¶æ‹</span>
                <span class="tip-tag" onclick="quickSearch('CBAS')">ğŸ’¡ CBAS</span>
                <span class="tip-tag" onclick="quickSearch('èè³‡')">ğŸ’¡ èè³‡</span>
                <span class="tip-tag" onclick="quickSearch('13164')">ğŸ’¡ ä¸Šæ›œå››</span>
                <span class="tip-tag" onclick="quickSearch('11011')">ğŸ’¡ å°æ³¥ä¸€æ°¸</span>
                <span class="tip-tag" onclick="quickSearch('1316')">ğŸ’¡ è‚¡ç¥¨ä»£è™Ÿ1316</span>
            </div>
        </div>

        <!-- çµæœå€åŸŸ -->
        <div class="results-container" id="resultsContainer">
            <div class="results-tabs">
                <button class="tab-button active" onclick="switchTab('articles')">
                    ğŸ“š æ–‡ç« çµæœ <span id="articleCount"></span>
                </button>
                <button class="tab-button" onclick="switchTab('stats')">
                    ğŸ“Š è³‡æ–™çµ±è¨ˆ
                </button>
                <button class="tab-button" onclick="switchTab('insights')">
                    ğŸ’¡ çŸ¥è­˜äº®é»
                </button>
                <button class="tab-button" onclick="switchTab('cb')">
                    ğŸ’¾ CBè³‡æ–™ <span id="cbCount"></span>
                </button>
            </div>

            <!-- æ–‡ç« çµæœ -->
            <div class="tab-content active" id="articlesTab">
                <div id="articlesResults"></div>
            </div>

            <!-- è³‡æ–™çµ±è¨ˆ -->
            <div class="tab-content" id="statsTab">
                <div id="statsResults"></div>
            </div>

            <!-- çŸ¥è­˜äº®é» -->
            <div class="tab-content" id="insightsTab">
                <div id="insightsResults"></div>
            </div>

            <!-- CBè³‡æ–™çµæœ -->
            <div class="tab-content" id="cbTab">
                <div id="cbResults"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let articlesData = [];
        let cbData = [];
        let currentTab = 'articles';

        // è¼‰å…¥è³‡æ–™
        async function loadData() {
            try {
                // è¼‰å…¥æ–‡ç« è³‡æ–™
                const articlesResponse = await fetch('kb_data_v1.0_20251102.json');
                const articlesJson = await articlesResponse.json();
                articlesData = articlesJson.articles || [];
                console.log('âœ… è¼‰å…¥', articlesData.length, 'ç¯‡æ–‡ç« ');

                // è¼‰å…¥CBè³‡æ–™
                const cbResponse = await fetch('cb_database.json');
                cbData = await cbResponse.json();
                console.log('âœ… è¼‰å…¥', cbData.length, 'ç­†CBè³‡æ–™');
            } catch (error) {
                console.error('âŒ è¼‰å…¥è³‡æ–™å¤±æ•—ï¼š', error);
                alert('è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªJSONæª”æ¡ˆæ˜¯å¦å­˜åœ¨');
            }
        }

        // çµ±ä¸€æœå°‹
        function unifiedSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—');
                return;
            }

            // æœå°‹æ–‡ç« 
            const articleResults = searchArticles(searchTerm);
            
            // æœå°‹CB
            const cbResults = searchCB(searchTerm);

            // é¡¯ç¤ºçµæœ
            displayResults(articleResults, cbResults, searchTerm);
        }

        // æœå°‹æ–‡ç« 
        function searchArticles(term) {
            const lowerTerm = term.toLowerCase();
            return articlesData.filter(article => {
                return (article.title && article.title.toLowerCase().includes(lowerTerm)) ||
                       (article.summary && article.summary.toLowerCase().includes(lowerTerm)) ||
                       (article.content && article.content.toLowerCase().includes(lowerTerm)) ||
                       (article.category && article.category.toLowerCase().includes(lowerTerm)) ||
                       (article.tags && article.tags.some(tag => tag.toLowerCase().includes(lowerTerm)));
            });
        }

        // æœå°‹CB
        function searchCB(term) {
            return cbData.filter(cb => {
                return (cb.CBä»£è™Ÿ && cb.CBä»£è™Ÿ.includes(term)) ||
                       (cb.CBåç¨± && cb.CBåç¨±.includes(term)) ||
                       (cb.è‚¡ç¥¨ä»£è™Ÿ && cb.è‚¡ç¥¨ä»£è™Ÿ.includes(term)) ||
                       (cb.è³‡é‡‘ç”¨é€” && cb.è³‡é‡‘ç”¨é€”.includes(term));
            });
        }

        // é¡¯ç¤ºçµæœ
        function displayResults(articleResults, cbResults, searchTerm) {
            const container = document.getElementById('resultsContainer');
            container.style.display = 'block';

            // æ›´æ–°è¨ˆæ•¸
            document.getElementById('articleCount').textContent = `(${articleResults.length})`;
            document.getElementById('cbCount').textContent = `(${cbResults.length})`;

            // é¡¯ç¤ºæ–‡ç« çµæœ
            displayArticles(articleResults, searchTerm);

            // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
            displayStats(articleResults, cbResults, searchTerm);

            // é¡¯ç¤ºçŸ¥è­˜äº®é»
            displayInsights(articleResults, cbResults, searchTerm);

            // é¡¯ç¤ºCBçµæœ
            displayCB(cbResults, searchTerm);

            // æ»¾å‹•åˆ°çµæœ
            container.scrollIntoView({ behavior: 'smooth' });
        }

        // é¡¯ç¤ºæ–‡ç« 
        function displayArticles(results, searchTerm) {
            const container = document.getElementById('articlesResults');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="no-result">
                        <div class="no-result-icon">ğŸ“š</div>
                        <h3>æ‰¾ä¸åˆ°ã€Œ${searchTerm}ã€ç›¸é—œçš„æ–‡ç« </h3>
                        <p>è©¦è©¦å…¶ä»–é—œéµå­—ï¼Œæˆ–é»æ“Šä¸Šæ–¹çš„æç¤ºæ¨™ç±¤</p>
                    </div>
                `;
                return;
            }

            let html = '';
            results.forEach(article => {
                html += `
                    <div class="article-card">
                        <h3 class="article-title">${article.title || 'ç„¡æ¨™é¡Œ'}</h3>
                        <div class="article-meta">
                            <span>ğŸ“… ${article.date || 'æœªçŸ¥æ—¥æœŸ'}</span>
                            <span>ğŸ“ ${article.category || 'æœªåˆ†é¡'}</span>
                            <span>â±ï¸ ${article.reading_time || 0} åˆ†é˜</span>
                        </div>
                        ${article.summary ? `<p class="article-summary">${article.summary}</p>` : ''}
                        ${article.tags && article.tags.length > 0 ? `
                            <div class="article-tags">
                                ${article.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        ${article.url ? `<a href="${article.url}" target="_blank" class="read-more">é–±è®€å®Œæ•´å…§å®¹ â†’</a>` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
        function displayStats(articleResults, cbResults, searchTerm) {
            const container = document.getElementById('statsResults');
            
            if (cbResults.length === 0 && articleResults.length === 0) {
                container.innerHTML = `
                    <div class="no-result">
                        <div class="no-result-icon">ğŸ“Š</div>
                        <h3>æ²’æœ‰è³‡æ–™å¯ä»¥çµ±è¨ˆ</h3>
                        <p>è©¦è©¦æœå°‹å…¶ä»–é—œéµå­—</p>
                    </div>
                `;
                return;
            }

            // è¨ˆç®—çµ±è¨ˆè³‡æ–™
            const stats = calculateStats(cbResults);
            
            let html = '<div class="stats-container">';
            
            // 1. åŸºæœ¬çµ±è¨ˆ
            html += `
                <div class="stat-card">
                    <div class="stat-title">ğŸ“Š æœå°‹çµæœçµ±è¨ˆ</div>
                    <div class="stat-list">
                        <div class="stat-list-item">
                            <span>æ‰¾åˆ°æ–‡ç« </span>
                            <span style="font-size: 1.5em; font-weight: 700; color: #3498db;">${articleResults.length} ç¯‡</span>
                        </div>
                        <div class="stat-list-item">
                            <span>æ‰¾åˆ°CBè³‡æ–™</span>
                            <span style="font-size: 1.5em; font-weight: 700; color: #e74c3c;">${cbResults.length} æª”</span>
                        </div>
                        <div class="stat-list-item">
                            <span>æœå°‹é—œéµå­—</span>
                            <span style="font-weight: 700; color: #27ae60;">${searchTerm}</span>
                        </div>
                    </div>
                </div>
            `;

            // 2. CBåƒ¹æ ¼çµ±è¨ˆ
            if (stats.avgHigh) {
                html += `
                    <div class="stat-card">
                        <div class="stat-title">ğŸ’° æ›ç‰Œæœ€é«˜åƒ¹</div>
                        <div class="stat-value">${stats.avgHigh.toFixed(2)} <span style="font-size: 0.5em;">å…ƒ</span></div>
                        <div class="stat-label">å¹³å‡åƒ¹æ ¼</div>
                        <div class="stat-list" style="margin-top: 15px;">
                            <div class="stat-list-item">
                                <span>æœ€é«˜</span>
                                <span style="color: #e74c3c; font-weight: 700;">${stats.maxHigh.toFixed(2)} å…ƒ</span>
                            </div>
                            <div class="stat-list-item">
                                <span>æœ€ä½</span>
                                <span style="color: #27ae60; font-weight: 700;">${stats.minHigh.toFixed(2)} å…ƒ</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 3. CBåƒ¹å·®çµ±è¨ˆ
            if (stats.avgSpread) {
                html += `
                    <div class="stat-card">
                        <div class="stat-title">ğŸ“Š æ›ç‰Œåƒ¹å·®</div>
                        <div class="stat-value">${stats.avgSpread.toFixed(2)} <span style="font-size: 0.5em;">å…ƒ</span></div>
                        <div class="stat-label">å¹³å‡åƒ¹å·®</div>
                        <div class="stat-list" style="margin-top: 15px;">
                            <div class="stat-list-item">
                                <span>æœ€å¤§åƒ¹å·®</span>
                                <span style="color: #e74c3c; font-weight: 700;">${stats.maxSpread.toFixed(2)} å…ƒ</span>
                            </div>
                            <div class="stat-list-item">
                                <span>æœ€å°åƒ¹å·®</span>
                                <span style="color: #27ae60; font-weight: 700;">${stats.minSpread.toFixed(2)} å…ƒ</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 4. æ¶µè“‹å…¬å¸çµ±è¨ˆ
            if (stats.companies > 0) {
                html += `
                    <div class="stat-card">
                        <div class="stat-title">ğŸ¢ æ¶µè“‹å…¬å¸æ•¸</div>
                        <div class="stat-value">${stats.companies} <span style="font-size: 0.5em;">å®¶</span></div>
                        <div class="stat-label">ä¸åŒå…¬å¸</div>
                    </div>
                `;
            }

            // 5. è³‡é‡‘ç”¨é€”åˆ†å¸ƒ
            if (Object.keys(stats.purposes).length > 0) {
                html += `
                    <div class="stat-card" style="grid-column: 1 / -1;">
                        <div class="stat-title">ğŸ’¼ è³‡é‡‘ç”¨é€”åˆ†å¸ƒ</div>
                        <div class="stat-list" style="margin-top: 15px;">
                `;
                
                const sortedPurposes = Object.entries(stats.purposes).sort((a, b) => b[1] - a[1]);
                sortedPurposes.forEach(([purpose, count]) => {
                    const percentage = (count / cbResults.length) * 100;
                    html += `
                        <div class="stat-list-item">
                            <span>${purpose}</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-weight: 700; color: #3498db;">${count} æª”</span>
                                <span style="color: #7f8c8d; font-size: 0.9em;">(${percentage.toFixed(1)}%)</span>
                            </div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        // è¨ˆç®—çµ±è¨ˆè³‡æ–™
        function calculateStats(cbResults) {
            const stats = {
                avgHigh: 0,
                maxHigh: 0,
                minHigh: 0,
                avgLow: 0,
                avgSpread: 0,
                maxSpread: 0,
                minSpread: 0,
                companies: 0,
                purposes: {}
            };

            if (cbResults.length === 0) return stats;

            // åƒ¹æ ¼çµ±è¨ˆ
            const highPrices = [];
            const lowPrices = [];
            const spreads = [];
            const companies = new Set();

            cbResults.forEach(cb => {
                if (cb.æ›ç‰Œæœ€é«˜) highPrices.push(cb.æ›ç‰Œæœ€é«˜);
                if (cb.æ›ç‰Œæœ€ä½) lowPrices.push(cb.æ›ç‰Œæœ€ä½);
                if (cb.æ›ç‰Œæœ€é«˜ && cb.æ›ç‰Œæœ€ä½) {
                    spreads.push(cb.æ›ç‰Œæœ€é«˜ - cb.æ›ç‰Œæœ€ä½);
                }
                if (cb.è‚¡ç¥¨ä»£è™Ÿ) companies.add(cb.è‚¡ç¥¨ä»£è™Ÿ);

                // è³‡é‡‘ç”¨é€”åˆ†é¡
                const purpose = cb.è³‡é‡‘ç”¨é€” || '';
                let category = 'å…¶ä»–';
                if (purpose.includes('å„Ÿé‚„') || purpose.includes('å€Ÿæ¬¾')) {
                    category = 'å„Ÿé‚„å€Ÿæ¬¾';
                } else if (purpose.includes('è½‰æŠ•è³‡') || purpose.includes('æŠ•è³‡')) {
                    category = 'è½‰æŠ•è³‡';
                } else if (purpose.includes('å» æˆ¿') || purpose.includes('è¨­å‚™') || purpose.includes('æ“´å»º')) {
                    category = 'è³‡æœ¬æ”¯å‡º';
                } else if (purpose.includes('ç‡Ÿé‹')) {
                    category = 'ç‡Ÿé‹è³‡é‡‘';
                }
                stats.purposes[category] = (stats.purposes[category] || 0) + 1;
            });

            if (highPrices.length > 0) {
                stats.avgHigh = highPrices.reduce((a, b) => a + b, 0) / highPrices.length;
                stats.maxHigh = Math.max(...highPrices);
                stats.minHigh = Math.min(...highPrices);
            }

            if (lowPrices.length > 0) {
                stats.avgLow = lowPrices.reduce((a, b) => a + b, 0) / lowPrices.length;
            }

            if (spreads.length > 0) {
                stats.avgSpread = spreads.reduce((a, b) => a + b, 0) / spreads.length;
                stats.maxSpread = Math.max(...spreads);
                stats.minSpread = Math.min(...spreads);
            }

            stats.companies = companies.size;

            return stats;
        }

        // é¡¯ç¤ºCBè³‡æ–™
        function displayCB(results, searchTerm) {
            const container = document.getElementById('cbResults');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="no-result">
                        <div class="no-result-icon">ğŸ“Š</div>
                        <h3>æ‰¾ä¸åˆ°ã€Œ${searchTerm}ã€ç›¸é—œçš„CBè³‡æ–™</h3>
                        <p>è©¦è©¦è¼¸å…¥CBä»£è™Ÿï¼ˆä¾‹å¦‚ï¼š13164ï¼‰æˆ–è‚¡ç¥¨ä»£è™Ÿï¼ˆä¾‹å¦‚ï¼š1316ï¼‰</p>
                    </div>
                `;
                return;
            }

            if (results.length > 20) {
                container.innerHTML = `
                    <div class="no-result">
                        <div class="no-result-icon">ğŸ”</div>
                        <h3>æ‰¾åˆ° ${results.length} ç­†è³‡æ–™</h3>
                        <p>çµæœå¤ªå¤šäº†ï¼è«‹è¼¸å…¥æ›´ç²¾ç¢ºçš„é—œéµå­—</p>
                    </div>
                `;
                return;
            }

            let html = '';
            results.forEach(cb => {
                html += `
                    <div class="cb-card">
                        <div class="cb-header">
                            <div class="cb-name">${cb.CBåç¨± || 'æœªçŸ¥'}</div>
                            <div class="cb-code">${cb.CBä»£è™Ÿ || 'æœªçŸ¥'}</div>
                        </div>
                        <div class="cb-info-grid">
                            <div class="cb-info-item">
                                <div class="cb-info-label">è‚¡ç¥¨ä»£è™Ÿ</div>
                                <div class="cb-info-value">${cb.è‚¡ç¥¨ä»£è™Ÿ || '-'}</div>
                            </div>
                            <div class="cb-info-item">
                                <div class="cb-info-label">æ›ç‰Œæœ€é«˜</div>
                                <div class="cb-info-value" style="color: #e74c3c;">${cb.æ›ç‰Œæœ€é«˜ ? cb.æ›ç‰Œæœ€é«˜.toFixed(2) + ' å…ƒ' : '-'}</div>
                            </div>
                            <div class="cb-info-item">
                                <div class="cb-info-label">æ›ç‰Œæœ€ä½</div>
                                <div class="cb-info-value" style="color: #3498db;">${cb.æ›ç‰Œæœ€ä½ ? cb.æ›ç‰Œæœ€ä½.toFixed(2) + ' å…ƒ' : '-'}</div>
                            </div>
                            <div class="cb-info-item">
                                <div class="cb-info-label">åƒ¹å·®</div>
                                <div class="cb-info-value" style="color: #27ae60;">
                                    ${cb.æ›ç‰Œæœ€é«˜ && cb.æ›ç‰Œæœ€ä½ ? (cb.æ›ç‰Œæœ€é«˜ - cb.æ›ç‰Œæœ€ä½).toFixed(2) + ' å…ƒ' : '-'}
                                </div>
                            </div>
                        </div>
                        ${cb.è³‡é‡‘ç”¨é€” ? `
                            <div class="cb-purpose">
                                <div class="cb-purpose-title">ğŸ’° è³‡é‡‘ç”¨é€”</div>
                                <div class="cb-purpose-text">${cb.è³‡é‡‘ç”¨é€”}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // é¡¯ç¤ºçŸ¥è­˜äº®é»
        function displayInsights(articleResults, cbResults, searchTerm) {
            const container = document.getElementById('insightsResults');
            const insights = generateInsights(articleResults, cbResults, searchTerm);
            
            if (insights.length === 0) {
                container.innerHTML = `
                    <div class="no-result">
                        <div class="no-result-icon">ğŸ’¡</div>
                        <h3>æš«ç„¡çŸ¥è­˜äº®é»</h3>
                        <p>è©¦è©¦æœå°‹å…¶ä»–é—œéµå­—</p>
                    </div>
                `;
                return;
            }

            let html = '';
            insights.forEach(insight => {
                html += `
                    <div class="insight-card ${insight.type}">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-content">${insight.content}</div>
                        ${insight.keywords ? `
                            <div class="insight-keywords">
                                ${insight.keywords.map(k => `<span class="insight-keyword">${k}</span>`).join('')}
                            </div>
                        ` : ''}
                        ${insight.source ? `
                            <div class="insight-source">ğŸ’¬ ${insight.source}</div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ç”¢ç”ŸçŸ¥è­˜äº®é»
        function generateInsights(articleResults, cbResults, searchTerm) {
            const insights = [];
            const lowerTerm = searchTerm.toLowerCase();

            // === Rexå¿ƒæ³•ï¼šå¾æ–‡ç« ä¸­æå– ===
            const rexWisdom = extractRexWisdom(articleResults, lowerTerm);
            insights.push(...rexWisdom);

            // === é¢¨éšªæé†’ ===
            const riskWarnings = generateRiskWarnings(cbResults, lowerTerm);
            insights.push(...riskWarnings);

            // === æŠ•è³‡é‡é» ===
            const investmentTips = generateInvestmentTips(cbResults, lowerTerm);
            insights.push(...investmentTips);

            // === å¸‚å ´è§€å¯Ÿ ===
            const marketObservations = generateMarketObservations(articleResults, cbResults, lowerTerm);
            insights.push(...marketObservations);

            return insights;
        }

        // æå–Rexå¿ƒæ³•
        function extractRexWisdom(articles, searchTerm) {
            const wisdom = [];
            
            // ç«¶æ‹ç›¸é—œ
            if (searchTerm.includes('ç«¶æ‹') || searchTerm.includes('æŠ•æ¨™')) {
                wisdom.push({
                    type: 'success',
                    icon: 'ğŸ¯',
                    title: 'Rexå¤§å”çš„ç«¶æ‹å¿ƒæ³•',
                    content: 'å°ˆæ³¨åœ¨æ¥è¿‘æœ€ä½å¾—æ¨™åƒ¹å¾—æ¨™ï¼Œå¾é ­åˆ°å°¾éƒ½ç·´ç¿’åªèƒ½è®“è‡ªå·±å¯«ä¸€å€‹åƒ¹æ ¼ã€‚æ§åˆ¶æŠ•æ¨™çš„åƒ¹æ ¼ï¼Œå°ˆæ³¨æ–¼é¢¨éšªï¼Œä¸è¿½æ±‚å ±é…¬ã€‚',
                    keywords: ['ç«¶æ‹ç­–ç•¥', 'é¢¨éšªæ§åˆ¶', 'åƒ¹æ ¼ç´€å¾‹'],
                    source: 'ä¾†è‡ªRexå¤§å”å¤šå¹´ç«¶æ‹ç¶“é©—'
                });
            }

            // CBASç›¸é—œ
            if (searchTerm.includes('cbas') || searchTerm.includes('é¸æ“‡æ¬Š')) {
                wisdom.push({
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'CBASé¢¨éšªæé†’',
                    content: 'CBASæ¬Šåˆ©é‡‘å¯èƒ½æ­¸é›¶ï¼Œé¢¨éšªè¼ƒé«˜ï¼CBç¾è‚¡æœ‰100å…ƒä¿æœ¬ï¼Œçµ•å°ä¸æœƒæ­¸é›¶ã€‚æ°¸é è¨˜ä½ï¼šåªèƒ½èªªã€ŒCBASæ¬Šåˆ©é‡‘æ­¸é›¶ã€ï¼Œä¸èƒ½èªªã€ŒCBæ­¸é›¶ã€ã€‚',
                    keywords: ['CBASé¢¨éšª', 'CBä¿æœ¬', 'æ­£ç¢ºç”¨è©'],
                    source: 'ä¾†è‡ªCBçŸ¥è­˜åº«é¢¨éšªèªçŸ¥'
                });
            }

            // èè³‡ç›¸é—œ
            if (searchTerm.includes('èè³‡') || searchTerm.includes('æ§“æ¡¿')) {
                wisdom.push({
                    type: 'warning',
                    icon: 'âš ï¸',
                    title: 'Rexå¤§å”çš„èè³‡ç¶“é©—',
                    content: 'èè³‡æ›¾ç¶“å°æˆ‘ä¾†èªªæ˜¯ä¸€å ´æƒ¡å¤¢ã€‚èè³‡å°±åƒå…©é¢åˆƒï¼Œå¿ƒè‡Ÿè¦å¤ å¼·æ‰è¡Œã€‚ä¸è¦è·Ÿæ•£æˆ¶ç«™åœ¨åŒä¸€å€‹æ–¹å‘ï¼Œè¦çœ‹æ‡‚èè³‡è®ŠåŒ–èƒŒå¾Œçš„æ„ç¾©ã€‚',
                    keywords: ['èè³‡é¢¨éšª', 'æ•£æˆ¶å¿ƒç†', 'ç±Œç¢¼è§€å¯Ÿ'],
                    source: 'ä¾†è‡ªRexå¤§å”çš„å¤±æ•—æ•™è¨“'
                });
            }

            // é¢¨éšªç®¡ç†ç›¸é—œ
            if (searchTerm.includes('é¢¨éšª') || searchTerm.includes('ç®¡ç†')) {
                wisdom.push({
                    type: 'tip',
                    icon: 'ğŸ’¡',
                    title: 'é¢¨éšªå„ªå…ˆçš„æŠ•è³‡ç†å¿µ',
                    content: 'å°ˆæ³¨æ–¼é¢¨éšªï¼Œä¸è¿½æ±‚å ±é…¬ã€‚å…ˆæƒ³æœ€å£çš„æƒ…æ³ï¼Œå†è€ƒæ…®ç²åˆ©ç©ºé–“ã€‚çµ¦è‡ªå·±å¤šä¸€é»çŠ¯éŒ¯çš„ç©ºé–“ï¼Œä¹Ÿè®“è‡ªå·±æœ‰å­¸ç¿’çš„æ©Ÿæœƒè®Šå¾—æ›´å¥½ã€‚',
                    keywords: ['é¢¨éšªå„ªå…ˆ', 'ä¿å®ˆç­–ç•¥', 'æŒçºŒå­¸ç¿’'],
                    source: 'ä¾†è‡ªRexå¤§å”25å¹´æŠ•è³‡ç¶“é©—'
                });
            }

            return wisdom;
        }

        // ç”¢ç”Ÿé¢¨éšªæé†’
        function generateRiskWarnings(cbResults, searchTerm) {
            const warnings = [];

            if (cbResults.length > 0) {
                // æª¢æŸ¥æ˜¯å¦æœ‰é«˜åƒ¹CB
                const highPriceCBs = cbResults.filter(cb => cb.æ›ç‰Œæœ€é«˜ && cb.æ›ç‰Œæœ€é«˜ > 200);
                if (highPriceCBs.length > 0) {
                    warnings.push({
                        type: 'warning',
                        icon: 'âš ï¸',
                        title: 'é«˜åƒ¹CBé¢¨éšªæé†’',
                        content: `æœå°‹çµæœä¸­æœ‰ ${highPriceCBs.length} æª”CBæ›ç‰Œæœ€é«˜åƒ¹è¶…é200å…ƒï¼Œå±¬æ–¼é«˜åƒ¹CBã€‚æŠ•è³‡é«˜åƒ¹CBéœ€è¦ç‰¹åˆ¥æ³¨æ„è‚¡åƒ¹æ³¢å‹•é¢¨éšªï¼Œå»ºè­°è©³ç´°è©•ä¼°è½‰æ›åƒ¹æ ¼èˆ‡ç›®å‰è‚¡åƒ¹çš„é—œä¿‚ã€‚`,
                        keywords: ['é«˜åƒ¹CB', 'æ³¢å‹•é¢¨éšª', 'è½‰æ›åƒ¹æ ¼']
                    });
                }

                // æª¢æŸ¥åƒ¹å·®
                const largeSpreads = cbResults.filter(cb => {
                    if (cb.æ›ç‰Œæœ€é«˜ && cb.æ›ç‰Œæœ€ä½) {
                        return (cb.æ›ç‰Œæœ€é«˜ - cb.æ›ç‰Œæœ€ä½) > 100;
                    }
                    return false;
                });
                if (largeSpreads.length > 0) {
                    warnings.push({
                        type: 'tip',
                        icon: 'ğŸ“Š',
                        title: 'åƒ¹å·®æ³¢å‹•è§€å¯Ÿ',
                        content: `æœ‰ ${largeSpreads.length} æª”CBçš„æ›ç‰Œåƒ¹å·®è¶…é100å…ƒï¼Œé¡¯ç¤ºæ­·å²æ³¢å‹•è¼ƒå¤§ã€‚å¤§æ³¢å‹•ä»£è¡¨æ©Ÿæœƒï¼Œä½†ä¹Ÿä¼´éš¨é¢¨éšªï¼Œå»ºè­°æ­é…æ–‡ç« äº†è§£æ³¢å‹•åŸå› ã€‚`,
                        keywords: ['åƒ¹å·®æ³¢å‹•', 'é¢¨éšªæ©Ÿæœƒ', 'æ³¢å‹•åŸå› ']
                    });
                }
            }

            return warnings;
        }

        // ç”¢ç”ŸæŠ•è³‡é‡é»
        function generateInvestmentTips(cbResults, searchTerm) {
            const tips = [];

            if (cbResults.length > 0) {
                // æª¢æŸ¥æ¥è¿‘100å…ƒçš„CB
                const nearParCBs = cbResults.filter(cb => {
                    if (cb.æ›ç‰Œæœ€ä½) {
                        return cb.æ›ç‰Œæœ€ä½ >= 95 && cb.æ›ç‰Œæœ€ä½ <= 105;
                    }
                    return false;
                });
                
                if (nearParCBs.length > 0) {
                    tips.push({
                        type: 'success',
                        icon: 'ğŸ’š',
                        title: 'ä¿æœ¬æ•ˆæœè§€å¯Ÿ',
                        content: `æœå°‹çµæœä¸­æœ‰ ${nearParCBs.length} æª”CBçš„æ›ç‰Œæœ€ä½åƒ¹åœ¨95-105å…ƒä¹‹é–“ï¼Œé¡¯ç¤ºä¿æœ¬æ•ˆæœè‰¯å¥½ã€‚é€™é¡CBé©åˆä¿å®ˆå‹æŠ•è³‡äººï¼Œä¸‹æª”é¢¨éšªç›¸å°è¼ƒä½ã€‚`,
                        keywords: ['ä¿æœ¬æ•ˆæœ', 'ä¸‹æª”ä¿è­·', 'ä¿å®ˆæŠ•è³‡']
                    });
                }

                // è³‡é‡‘ç”¨é€”åˆ†æ
                const purposeAnalysis = analyzePurpose(cbResults);
                if (purposeAnalysis) {
                    tips.push(purposeAnalysis);
                }
            }

            return tips;
        }

        // åˆ†æè³‡é‡‘ç”¨é€”
        function analyzePurpose(cbResults) {
            const purposes = {};
            cbResults.forEach(cb => {
                const purpose = cb.è³‡é‡‘ç”¨é€” || '';
                if (purpose.includes('å„Ÿé‚„') || purpose.includes('å€Ÿæ¬¾')) {
                    purposes['å„Ÿé‚„å€Ÿæ¬¾'] = (purposes['å„Ÿé‚„å€Ÿæ¬¾'] || 0) + 1;
                } else if (purpose.includes('è½‰æŠ•è³‡') || purpose.includes('æŠ•è³‡')) {
                    purposes['è½‰æŠ•è³‡'] = (purposes['è½‰æŠ•è³‡'] || 0) + 1;
                } else if (purpose.includes('å» æˆ¿') || purpose.includes('è¨­å‚™') || purpose.includes('æ“´å»º')) {
                    purposes['è³‡æœ¬æ”¯å‡º'] = (purposes['è³‡æœ¬æ”¯å‡º'] || 0) + 1;
                } else if (purpose.includes('ç‡Ÿé‹')) {
                    purposes['ç‡Ÿé‹è³‡é‡‘'] = (purposes['ç‡Ÿé‹è³‡é‡‘'] || 0) + 1;
                }
            });

            const mainPurpose = Object.keys(purposes).sort((a, b) => purposes[b] - purposes[a])[0];
            if (mainPurpose) {
                let content = '';
                if (mainPurpose === 'å„Ÿé‚„å€Ÿæ¬¾') {
                    content = `æœå°‹çµæœä¸­ï¼Œå¤šæ•¸CBç”¨æ–¼å„Ÿé‚„å€Ÿæ¬¾ã€‚é€™é¡CBé€šå¸¸æ˜¯å€Ÿæ–°é‚„èˆŠï¼Œå»ºè­°é—œæ³¨å…¬å¸è²¡å‹™çµæ§‹å’Œé‚„æ¬¾èƒ½åŠ›ã€‚`;
                } else if (mainPurpose === 'è½‰æŠ•è³‡') {
                    content = `æœå°‹çµæœä¸­ï¼Œå¤šæ•¸CBç”¨æ–¼è½‰æŠ•è³‡ã€‚ä»£è¡¨å…¬å¸æœ‰æ“´å¼µè¨ˆåŠƒï¼Œå»ºè­°äº†è§£è½‰æŠ•è³‡æ¨™çš„å’Œé æœŸæ•ˆç›Šã€‚`;
                } else if (mainPurpose === 'è³‡æœ¬æ”¯å‡º') {
                    content = `æœå°‹çµæœä¸­ï¼Œå¤šæ•¸CBç”¨æ–¼è³‡æœ¬æ”¯å‡ºï¼ˆå» æˆ¿ã€è¨­å‚™ï¼‰ã€‚ä»£è¡¨å…¬å¸æ­£åœ¨æ“´å¤§ç”¢èƒ½ï¼Œå»ºè­°è©•ä¼°ç”¢æ¥­æ™¯æ°£å’Œæ“´ç”¢æ•ˆç›Šã€‚`;
                } else if (mainPurpose === 'ç‡Ÿé‹è³‡é‡‘') {
                    content = `æœå°‹çµæœä¸­ï¼Œå¤šæ•¸CBç”¨æ–¼ç‡Ÿé‹è³‡é‡‘ã€‚å»ºè­°è©•ä¼°å…¬å¸ç¾é‡‘æµç‹€æ³å’Œç‡Ÿé‹éœ€æ±‚ã€‚`;
                }

                return {
                    type: 'tip',
                    icon: 'ğŸ’¼',
                    title: 'è³‡é‡‘ç”¨é€”åˆ†æ',
                    content: content,
                    keywords: [mainPurpose, 'ç”¨é€”åˆ†æ', 'æŠ•è³‡è©•ä¼°']
                };
            }

            return null;
        }

        // ç”¢ç”Ÿå¸‚å ´è§€å¯Ÿ
        function generateMarketObservations(articles, cbResults, searchTerm) {
            const observations = [];

            // å¦‚æœæ‰¾åˆ°ç›¸é—œæ–‡ç« å’ŒCBï¼Œå»ºè­°äº¤å‰é–±è®€
            if (articles.length > 0 && cbResults.length > 0) {
                observations.push({
                    type: 'success',
                    icon: 'ğŸ“š',
                    title: 'å­¸ç¿’å»ºè­°',
                    content: `æ‰¾åˆ° ${articles.length} ç¯‡ç›¸é—œæ–‡ç« å’Œ ${cbResults.length} æª”CBè³‡æ–™ï¼å»ºè­°å…ˆé–±è®€æ–‡ç« äº†è§£æŠ•è³‡åŸç†å’Œç­–ç•¥ï¼Œå†æŸ¥çœ‹CBå…·é«”è³‡æ–™é€²è¡Œè©•ä¼°ã€‚ç†è«–èˆ‡å¯¦å‹™çµåˆï¼ŒæŠ•è³‡æ›´æœ‰æŠŠæ¡ã€‚`,
                    keywords: ['ç†è«–å¯¦å‹™', 'äº¤å‰å­¸ç¿’', 'æŠ•è³‡è©•ä¼°']
                });
            }

            // å¦‚æœæ˜¯æ•¸å­—æœå°‹ï¼ˆå¯èƒ½æ˜¯ä»£è™Ÿï¼‰
            if (/^\d+$/.test(searchTerm)) {
                if (cbResults.length > 0) {
                    observations.push({
                        type: 'tip',
                        icon: 'ğŸ”',
                        title: 'æ·±åº¦ç ”ç©¶å»ºè­°',
                        content: 'æ‚¨æœå°‹çš„æ˜¯CBä»£è™Ÿæˆ–è‚¡ç¥¨ä»£è™Ÿã€‚å»ºè­°é€²ä¸€æ­¥æŸ¥çœ‹ï¼š1) è©²å…¬å¸çš„ç”¢æ¥­åœ°ä½ 2) æ­·å²è²¡å‹™è¡¨ç¾ 3) CBç™¼è¡Œæ¢ä»¶ 4) ç›¸é—œçš„æŠ•è³‡æ–‡ç« ã€‚å®Œæ•´çš„ç ”ç©¶æ˜¯æˆåŠŸæŠ•è³‡çš„åŸºç¤ã€‚',
                        keywords: ['æ·±åº¦ç ”ç©¶', 'åŸºæœ¬é¢', 'ç™¼è¡Œæ¢ä»¶']
                    });
                }
            }

            return observations;
        }

        // åˆ‡æ›åˆ†é ï¼ˆæ›´æ–°ï¼‰
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tab === 'articles') {
                document.getElementById('articlesTab').classList.add('active');
            } else if (tab === 'stats') {
                document.getElementById('statsTab').classList.add('active');
            } else if (tab === 'cb') {
                document.getElementById('cbTab').classList.add('active');
            }
        }

        // å¿«é€Ÿæœå°‹
        function quickSearch(term) {
            document.getElementById('searchInput').value = term;
            unifiedSearch();
        }

        // Enteréµæ”¯æ´
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    unifiedSearch();
                }
            });

            // è¼‰å…¥è³‡æ–™
            loadData();
        });
    </script>
</body>
</html>






